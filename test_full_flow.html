<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Flow Test</title>
    <style>
        .step { margin: 20px 0; padding: 15px; border-left: 4px solid #007bff; background: #f8f9fa; }
        .step.completed { border-left-color: #28a745; background: #d4edda; }
        .step.failed { border-left-color: #dc3545; background: #f8d7da; }
        button { margin: 5px; }
    </style>
</head>
<body>
    <h1>Complete Shopping Flow Test</h1>
    
    <div class="step" id="step1">
        <h3>Step 1: Load Products</h3>
        <button onclick="testStep1()">Test Get Products</button>
        <div id="step1-result"></div>
    </div>

    <div class="step" id="step2">
        <h3>Step 2: Add to Cart</h3>
        <button onclick="testStep2()">Test Add to Cart</button>
        <div id="step2-result"></div>
    </div>

    <div class="step" id="step3">
        <h3>Step 3: View Cart</h3>
        <button onclick="testStep3()">Test Get Cart</button>
        <div id="step3-result"></div>
    </div>

    <div class="step" id="step4">
        <h3>Step 4: Place Order</h3>
        <button onclick="testStep4()">Test Process Order</button>
        <div id="step4-result"></div>
    </div>

    <button onclick="runAllTests()" style="padding: 10px 20px; background: #28a745; color: white;">Run All Tests</button>

    <script>
        async function testStep1() {
            try {
                const response = await fetch('get_products.php?category=classic');
                const products = await response.json();
                
                document.getElementById('step1-result').innerHTML = 
                    `✅ Success! Loaded ${products.length} products. First product: ${products[0].name}`;
                document.getElementById('step1').classList.add('completed');
                
            } catch (error) {
                document.getElementById('step1-result').innerHTML = `❌ Error: ${error}`;
                document.getElementById('step1').classList.add('failed');
            }
        }

        async function testStep2() {
            try {
                const formData = new FormData();
                formData.append('product_id', '1');
                formData.append('product_name', 'Test Product');
                formData.append('product_price', '100.00');
                
                const response = await fetch('add_to_cart.php', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                document.getElementById('step2-result').innerHTML = 
                    `✅ ${result.message}. Cart count: ${result.cart_count}`;
                document.getElementById('step2').classList.add('completed');
                
            } catch (error) {
                document.getElementById('step2-result').innerHTML = `❌ Error: ${error}`;
                document.getElementById('step2').classList.add('failed');
            }
        }

        async function testStep3() {
            try {
                const response = await fetch('get_cart.php');
                const cart = await response.json();
                
                document.getElementById('step3-result').innerHTML = 
                    `✅ Success! Cart has ${cart.total_count} items. Total: $${cart.total_price}`;
                document.getElementById('step3').classList.add('completed');
                
            } catch (error) {
                document.getElementById('step3-result').innerHTML = `❌ Error: ${error}`;
                document.getElementById('step3').classList.add('failed');
            }
        }

        async function testStep4() {
            try {
                const formData = new FormData();
                formData.append('customer_phone', '12345678');
                
                const response = await fetch('process_order.php', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                document.getElementById('step4-result').innerHTML = 
                    `✅ ${result.message}. Confirmation: ${result.confirmation_phone}`;
                document.getElementById('step4').classList.add('completed');
                
            } catch (error) {
                document.getElementById('step4-result').innerHTML = `❌ Error: ${error}`;
                document.getElementById('step4').classList.add('failed');
            }
        }

        async function runAllTests() {
            // Reset all steps
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('completed', 'failed');
            });
            
            await testStep1();
            await testStep2(); 
            await testStep3();
            await testStep4();
        }
    </script>
</body>
</html>